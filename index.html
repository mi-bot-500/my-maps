<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Mappa GPX</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 100vh; width: 100%; margin: 0; }
        body { margin: 0; padding: 0; }
        .leaflet-tooltip { font-size: 14px; padding: 10px; }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>

    <script>
        var map = L.map('map').setView([0, 0], 2);

        L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            maxZoom: 17,
            attribution: 'Map data: ¬© OSM | Style: ¬© OpenTopoMap'
        }).addTo(map);

        var tracks = ['tracks/1.gpx', 'tracks/2.gpx'];

        tracks.forEach(function(url) {
            new L.GPX(url, {
                async: true,
                marker_options: { startIconUrl: '', endIconUrl: '', shadowUrl: '' },
                polyline_options: { color: '#0000FF', weight: 4, opacity: 0.6 }
            }).on('loaded', function(e) {
                var gpx = e.target;
                var name = gpx.get_name() || "Track";
                var dist = (gpx.get_distance() / 1000).toFixed(2);
                var date = gpx.get_start_time() ? gpx.get_start_time().toLocaleDateString() : "---";

                var info = `<b>${name}</b><br>üìÖ ${date}<br>üìè ${dist} km<br>üñ±Ô∏è <i>Click destro per scaricare</i>`;

                gpx.getLayers().forEach(function(layer) {
                    // –ù–∞–≤–µ–¥–µ–Ω–∏–µ
                    layer.on('mouseover', function(evt) {
                        layer.setStyle({ color: '#FF0000', weight: 6, opacity: 1 });
                        layer.bindTooltip(info, { sticky: true }).openTooltip();
                    });
                    layer.on('mouseout', function() {
                        layer.setStyle({ color: '#0000FF', weight: 4, opacity: 0.6 });
                    });

                    // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–µ
                    layer.on('contextmenu', function(evt) {
                        L.DomEvent.stopPropagation(evt);
                        if (confirm("Scaricare " + url.split('/').pop() + "?")) {
                            var link = document.createElement('a');
                            link.href = url;
                            link.download = url.split('/').pop();
                            link.click();
                        }
                    });
                });

                map.fitBounds(gpx.getBounds());
            }).addTo(map);
        });
    </script>
</body>
</html>
