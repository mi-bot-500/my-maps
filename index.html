<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Mappa con Livelli</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 100vh; width: 100%; margin: 0; }
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>

    <script>
        // 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap'
        });

        var topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenTopoMap'
        });

        var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '¬© Esri Satellite'
        });

        var terrain = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
            attribution: '¬© Esri Terrain'
        });

        var cyclOSM = L.tileLayer('https://{s}.tile.cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png', {
            attribution: '¬© CyclOSM'
        });

        // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º —Å–ª–æ–µ–º
        var map = L.map('map', {
            center: [0, 0],
            zoom: 2,
            layers: [terrain] // –°–ª–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∫–∞–∫ –Ω–∞ —Ç–≤–æ–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–µ)
        });

        // 3. –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
        var baseMaps = {
            "–†–µ–ª—å–µ—Ñ (–∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ)": terrain,
            "–î–µ—Ç–∞–ª—å–Ω–∞—è (Hike)": cyclOSM,
            "–¢–æ–ø–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è": topo,
            "–°–ø—É—Ç–Ω–∏–∫": satellite,
            "–°—Ç–∞–Ω–¥–∞—Ä—Ç OSM": osm
        };

        L.control.layers(baseMaps).addTo(map);

        // 4. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–æ–≤ (–ª–æ–≥–∏–∫–∞ —Ç–∞ –∂–µ)
        var tracks = ['tracks/1.gpx', 'tracks/2.gpx'];
        tracks.forEach(function(url) {
            new L.GPX(url, {
                async: true,
                marker_options: { startIconUrl: '', endIconUrl: '', shadowUrl: '' },
                polyline_options: { color: 'blue', weight: 4 }
            }).on('loaded', function(e) {
                var gpx = e.target;
                var info = `<b>${gpx.get_name()}</b><br>üìè ${(gpx.get_distance()/1000).toFixed(2)} km`;
                
                gpx.getLayers().forEach(function(layer) {
                    layer.bindTooltip(info, { sticky: true });
                    layer.on('contextmenu', function() {
                        if(confirm("Download?")) { window.location.href = url; }
                    });
                });
                map.fitBounds(gpx.getBounds());
            }).addTo(map);
        });
    </script>
</body>
</html>
